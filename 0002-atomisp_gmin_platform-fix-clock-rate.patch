From 02ff94b4b7fe7f2f7fbc37fe35d878e4df98622c Mon Sep 17 00:00:00 2001
From: Vincent Hervieux <vincent.hervieux@telecomsante.com>
Date: Wed, 24 Jan 2018 14:11:05 +0100
Subject: [PATCH] atomisp_gmin_platform-fix-clock-rate

Signed-off-by: Vincent Hervieux <vincent.hervieux@gmail.com>
---
 .../media/atomisp/platform/intel-mid/atomisp_gmin_platform.c      | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/media/atomisp/platform/intel-mid/atomisp_gmin_platform.c b/drivers/staging/media/atomisp/platform/intel-mid/atomisp_gmin_platform.c
index bf9f34b7ad72..537dd0f4f3b3 100644
--- a/drivers/staging/media/atomisp/platform/intel-mid/atomisp_gmin_platform.c
+++ b/drivers/staging/media/atomisp/platform/intel-mid/atomisp_gmin_platform.c
@@ -18,6 +18,8 @@
 #define MAX_SUBDEVS 8
 
 #define VLV2_CLK_PLL_19P2MHZ 1 /* XTAL on CHT */
+#define VLV2_CLK_XTAL_19P2MHZ 0
+#define VLV2_CLK_FREQ 19200000 /* 19,2MHz */
 #define ELDO1_SEL_REG	0x19
 #define ELDO1_1P8V	0x16
 #define ELDO1_CTRL_SHIFT 0x00
@@ -514,11 +516,11 @@ static int gmin_flisclk_ctrl(struct v4l2_subdev *subdev, int on)
 		return 0;
 
 	if (on) {
-		ret = clk_set_rate(gs->pmc_clk, gs->clock_src);
+		unsigned long rate = (unsigned long)VLV2_CLK_FREQ * 1000;
+		ret = clk_set_rate(gs->pmc_clk, rate);
 
 		if (ret)
-			dev_err(&client->dev, "unable to set PMC rate %d\n",
-				gs->clock_src);
+			dev_err(&client->dev, "unable to set PMC rate %lu\n", rate);
 
 		ret = clk_prepare_enable(gs->pmc_clk);
 		if (ret == 0)
-- 
2.11.0

